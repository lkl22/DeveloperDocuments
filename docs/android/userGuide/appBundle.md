# Android App Bundle 简介

> 重要提示：从 2021 年 8 月起，新应用需要使用 Android App Bundle 才能在 Google Play 中发布。现在，Play Feature Delivery 或 Play Asset Delivery 支持大小超过 150 MB 的新应用。

Android App Bundle 是一种发布格式，其中包含您应用的所有经过编译的代码和资源，它会将 APK 生成及签名交由 Google Play 来完成。

Google Play 会使用您的 App Bundle 针对每种设备配置生成并提供经过优化的 APK，因此只会下载特定设备所需的代码和资源来运行您的应用。您不必再构建、签署和管理多个 APK 来优化对不同设备的支持，而用户也可以获得更小且更优化的下载文件包。

对于大多数应用项目而言，构建 App Bundle 以支持提供经过优化的 APK 并不费力。例如，如果您已经按照既定惯例组织管理应用的代码和资源，只需使用 Android Studio 或使用命令行来构建已签名的 Android App Bundle，并将它们上传到 Google Play。然后，就能提供经过优化的 APK，自动获享其带来的优势了。

使用 App Bundle 格式发布应用时，您也可以选择使用 Play Feature Delivery，它可让您向应用项目中添加功能模块。这些模块包含仅根据您指定的条件随应用提供的功能和资源，或者稍后在运行时供使用 Play 核心库下载的功能和资源。

使用 App Bundle 发布应用的游戏开发者可以使用 Play Asset Delivery：它是 Google Play 用于分发大量游戏资产的解决方案，为开发者提供了灵活的分发方式和极高的性能。

## 压缩下载大小限制

使用 Android App Bundle 发布应用可帮助用户以尽可能最小的下载大小安装您的应用，并将压缩下载大小上限提高到 150MB。也就是说，当用户下载您的应用时，安装应用所需的压缩 APK（例如，基本 APK + 配置 APK）的总大小不得超过 150 MB。任何后续下载内容（如按需下载功能模块（及其配置 APK））也必须满足此压缩下载大小限制。Asset Pack 不受此大小限制，但它们有其他大小限制。

上传 app bundle 时，如果 Play 管理中心发现您的应用或其按需功能的可能下载大小超过 150MB，您会收到错误。

请注意，Android App Bundle 不支持 APK 扩展 (*.obb) 文件。因此，如果您在发布 App Bundle 时遇到此错误，请使用以下某种资源来缩减压缩的 APK 下载大小：

* 请务必为每种类型的配置 APK 设置 enableSplit = true 以启用所有配置 APK。这样可以确保用户只下载在其设备上运行您的应用所需的代码和资源。
* 请务必移除不用的代码和资源以缩减应用大小。
* 遵循最佳做法以进一步缩减应用大小。
* 考虑将只有部分用户使用的功能转换为应用可以在日后按需下载的功能模块。请注意，这可能需要对您的应用稍微进行重构，因此请务必先尝试上述其他建议。

## 其他注意事项
以下介绍了当前已知在使用 Android App Bundle 构建或提供应用时会出现的问题。如果您遇到下文尚未说明的问题，请报告错误。

* 部分安装旁加载的应用（即，未通过 Google Play 商店安装且缺少一个或多个必需拆分 APK 的应用）在所有经过 Google 认证的设备上以及搭载 Android 10（API 级别 29）或更高版本的设备上都会失败。通过 Google Play 商店下载您的应用时，Google 会确保安装应用的所有必需组件。
* 如果您使用会动态修改资源表的工具，则从 App Bundle 生成的 APK 可能会行为异常。因此，在构建 App Bundle 时，建议您停用此类工具。
* 目前可以在功能模块的构建配置中配置与基本模块或其他模块中的属性相冲突的属性。例如，您可以在基本模块中设置 buildTypes.release.debuggable = true，而在功能模块中将其设置为 false。此类冲突可能会导致构建和运行时问题。请注意，默认情况下，功能模块会从基本模块继承一些构建配置。因此，请务必了解在功能模块构建配置中应保留哪些配置以及应省略哪些配置。


